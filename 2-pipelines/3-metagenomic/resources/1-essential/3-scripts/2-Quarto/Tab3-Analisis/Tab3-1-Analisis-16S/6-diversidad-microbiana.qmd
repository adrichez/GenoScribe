---
title: "Metagenomic Report"

include-in-header:
  text: |
    <link rel="shortcut icon" href="../../../../1-images/icono/favicon.svg"/>
    <link rel="icon" type="image/x-icon" href="../../../../1-images/icono/favicon.ico">

params:
  ruta_proyecto: ""
  tipo_analisis: ""
---


<!-- &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& -->
<!--  CHATBOT
<!-- &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& -->

<div id="chat-container">
  <button id="chat-toggle"></button>
  <div id="chat-box">
    <div id="chat-log"></div>
    <input id="chat-input" type="text" placeholder="Escribe tu pregunta..."/>
  </div>
</div>










<!-- &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& -->
<!--  TAB 3: AN√ÅLISIS | 6. DIVERSIDAD MICROBIANA -->
<!-- &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& -->

```{r}
# Cargar librer√≠as
library(glue)
library(fs)
library(stringr)
library(dplyr)


# Rutas clave
ruta_qmd <- getwd()
ruta_metagenomic_pipeline <- file.path("..", "..", "..", "..", "..", "..")
nombre_proyecto <- basename(params$ruta_proyecto)


# Rutas de resultados Nextflow
ruta_nextflow_results <- file.path("..", "..", "..", "..", "..", "..", "resources", "2-nextflow-results")
ruta_proyecto_relativa <- file.path("..", "..", "..", "..", "..", "..", "resources", "2-nextflow-results", "1-project-data", nombre_proyecto)


# Rutas de la carpeta 
ruta_Def <- file.path(params$ruta_proyecto, "Resultados", "Def")
ruta_Def_relativa <- file.path(ruta_proyecto_relativa, "Resultados", "Def")


# Definir ruta del archivo alpha-rarefaction.qzv
ruta_alpha_rarefaction_qzv_relativa <- file.path(ruta_Def_relativa, "alpha-rarefaction.qzv")
ruta_alpha_rarefaction_qzv <- file.path(ruta_Def, "alpha-rarefaction.qzv")

# Definir ruta de salida para el unzip
ruta_Def_unzip <- file.path(ruta_Def_relativa, "unzip")
ruta_unzip_alpha_rarefaction <- file.path(ruta_Def_unzip, "alpha-rarefaction")

# Crear carpeta de salida si no existe
if (!dir.exists(ruta_Def_unzip)) dir.create(ruta_Def_unzip, recursive = TRUE)

# Solo hacer unzip si el archivo existe
if (file.exists(ruta_alpha_rarefaction_qzv_relativa)) {
  # Usando system2 para llamar a unzip desde R
  system2("unzip", args = c("-o", shQuote(ruta_alpha_rarefaction_qzv_relativa),
                            "-d", shQuote(ruta_unzip_alpha_rarefaction)))
} else {
  message("‚ö†Ô∏è El archivo alpha-rarefaction.qzv no existe. Se omite el unzip.")
}


# Comprobar que el unzip se ha realizado
if (dir.exists(ruta_unzip_alpha_rarefaction)) {
  
  # Listar subcarpetas dentro de la carpeta unzip (solo 1er nivel)
  subcarpetas <- list.dirs(ruta_unzip_alpha_rarefaction, recursive = FALSE, full.names = TRUE)
  
  if (length(subcarpetas) == 0) {
    stop("No se encontr√≥ ninguna subcarpeta dentro de ", ruta_unzip_alpha_rarefaction)
  }
  
  # Tomamos la primera subcarpeta (la aleatoria generada por QIIME2)
  carpeta_random <- subcarpetas[1]
  
  # Ruta a 'data'
  ruta_data <- file.path(carpeta_random, "data")
  
  # Archivos dentro de 'data'
  ruta_faith_pd_csv <- file.path(carpeta_random, "data", "faith_pd.csv")
  ruta_observed_features_csv <- file.path(carpeta_random, "data", "observed_features.csv")
  ruta_shannon_csv <- file.path(carpeta_random, "data", "shannon.csv")
  ruta_index_html <- file.path(ruta_data, "index.html")
  
  # Comprobar que existen
  if (!file.exists(ruta_faith_pd_csv)) message("‚ö†Ô∏è faith_pd.csv no encontrado")
  if (!file.exists(ruta_observed_features_csv)) message("‚ö†Ô∏è observed_features.csv no encontrado")
  if (!file.exists(ruta_shannon_csv)) message("‚ö†Ô∏è shannon.csv no encontrado")
  if (!file.exists(ruta_index_html)) message("‚ö†Ô∏è index.html no encontrado")
  
} else {
  message("‚ö†Ô∏è Carpeta de unzip no encontrada. No se puede acceder a los archivos.")
}


# Rutas de la carpeta core-metrics-results
ruta_core_metrics_results <- file.path(ruta_Def, "core-metrics-results")
ruta_core_metrics_results_relativa <- file.path(ruta_Def_relativa, "core-metrics-results")


# Carpeta donde se guardar√°n los unzip
directorio_unzip <- file.path(ruta_core_metrics_results_relativa, "unzip")
if (!dir.exists(directorio_unzip)) dir.create(directorio_unzip, recursive = TRUE)

# Listar todos los archivos .qzv en el directorio
archivos_qzv <- list.files(ruta_core_metrics_results_relativa, pattern = "\\.qzv$", full.names = TRUE)

# Iterar sobre cada archivo
for (archivo in archivos_qzv) {
  
  # Nombre base sin extensi√≥n
  nombre_base <- tools::file_path_sans_ext(basename(archivo))
  
  # Carpeta de salida para este archivo
  carpeta_salida <- file.path(directorio_unzip, nombre_base)
  if (!dir.exists(carpeta_salida)) dir.create(carpeta_salida, recursive = TRUE)
  
  # Descomprimir
  system2("unzip", args = c("-o", shQuote(archivo),
                            "-d", shQuote(carpeta_salida)))
  
  # Comprobar que se descomprimi√≥ correctamente
  if (dir.exists(carpeta_salida)) {
    message("‚úÖ Descomprimido: ", archivo, " ‚Üí ", carpeta_salida)
  } else {
    warning("‚ö†Ô∏è No se pudo descomprimir: ", archivo)
  }
}


# Directorio ra√≠z donde guardaste los unzip
directorio_core_metrics_results_unzip <- file.path(ruta_core_metrics_results_relativa, "unzip")

# Lista de carpetas de los qzv descomprimidos
carpetas_qzv <- list.dirs(directorio_core_metrics_results_unzip, recursive = FALSE, full.names = TRUE)

# Lista para guardar rutas a index.html
indices_html <- list()

for (carpeta in carpetas_qzv) {
  # Buscar subcarpetas (nivel 1) ‚Üí hash aleatorio
  subcarpetas <- list.dirs(carpeta, recursive = FALSE, full.names = TRUE)
  
  if (length(subcarpetas) > 0) {
    carpeta_random <- subcarpetas[1]
    ruta_index <- file.path(carpeta_random, "data", "index.html")
    
    if (file.exists(ruta_index)) {
      indices_html[[basename(carpeta)]] <- ruta_index
      message("‚úÖ index.html encontrado: ", ruta_index)
    } else {
      message("‚ö†Ô∏è No se encontr√≥ index.html en: ", carpeta)
    }
  } else {
    message("‚ö†Ô∏è No se encontr√≥ subcarpeta en: ", carpeta)
  }
}
```


<div class="informe-titulo-tab">
  <h1>Pesta√±a</h1>
  <h2>An√°lisis 16S bioinform√°tico completo</h2>
</div>

<div class="informe-titulo-seccion">
  <h1>Secci√≥n 6</h1>
  <h2>Diversidad microbiana</h2>
</div>

<div class="flecha-abajo">
  ‚ñº
</div>


<div class="informe-resumen">
  <h2>Resumen</h2>

  <p>
    Resumen aqu√≠
  </p>
</div>










<div style="height: 15px; background-color: transparent;"></div>

<div class="titulo-toc">
  Tabla de contenidos de esta secci√≥n
</div>

<div class="toc">
  <ul>
    <li>
      <a href="#tab3-seccion6">
        6<span>.</span> Diversidad microbiana
      </a>
      <ul>
        <li>
          <a href="#tab3-seccion6.1">
            6.1. Curvas de rarefacci√≥n y cobertura
          </a>
        </li>
        <li>
          <a href="#tab3-seccion6.2">
            6.2. Diversidad alfa (dentro de muestras)
          </a>
          <ul>
            <li>
              <a href="#tab3-seccion6.2.1">
                  6.2.1. √çndice de Shannon (riqueza + equidad)
              </a>
            </li>
            <li>
              <a href="#tab3-seccion6.2.2">
                  6.2.2. Diversidad filogen√©tica de Faith (longitud de ramas evolutivas)
              </a>
            </li>
            <li>
              <a href="#tab3-seccion6.2.3">
                  6.2.3. Evenness (uniformidad de abundancias)
              </a>
            </li>
            <li>
              <a href="#tab3-seccion6.2.4">
                  6.2.4. Riqueza observada (Observed Features)
              </a>
            </li>
          </ul>
        </li>
        <li>
          <a href="#tab3-seccion6.3">
            6.3. Diversidad beta (entre muestras)
          </a>
          <ul>
            <li>
              <a href="#tab3-seccion6.3.1">
                  6.3.1. Distancia de Bray‚ÄìCurtis (abundancias relativas)
              </a>
            </li>
            <li>
              <a href="#tab3-seccion6.3.2">
                  6.3.2. Distancia de Jaccard (presencia/ausencia)
              </a>
            </li>
            <li>
              <a href="#tab3-seccion6.3.3">
                  6.3.3. Unweighted UniFrac (filogenia + presencia/ausencia)
              </a>
            </li>
            <li>
              <a href="#tab3-seccion6.3.4">
                  6.3.4. Weighted UniFrac (filogenia + abundancias)
              </a>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</div>










<!-- #%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- REDACCI√ìN -->
<!-- #%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

<div style="height: 25px; background-color: transparent;"></div>

<div class="titulo1" id="tab3-seccion6">
  6<span>.</span> Diversidad microbiana
</div>

<p>
  La diversidad microbiana es un componente esencial para comprender la organizaci√≥n, el equilibrio y la funci√≥n de las comunidades presentes en cada muestra. No se trata √∫nicamente de identificar qu√© organismos est√°n ah√≠, sino de profundizar en c√≥mo se distribuyen, c√≥mo interact√∫an y qu√© diferencias existen entre unas comunidades y otras. El an√°lisis de diversidad nos permite, por tanto, responder a preguntas clave: ¬ølas comunidades son m√°s ricas o m√°s pobres en determinados grupos experimentales?, ¬øexiste una distribuci√≥n equitativa de los microorganismos o hay dominancia de unas pocas especies?, ¬ølas comunidades de distintos individuos o condiciones se parecen o son completamente diferentes?
</p>

<p>
  Para abordar estas preguntas se emplean distintas m√©tricas, muchas de las cuales han sido obtenidas mediante el flujo de trabajo de QIIME2 y que aqu√≠ ser√°n interpretadas y contextualizadas. Estas m√©tricas se organizan en tres grandes bloques:
</p>

<ul style="list-style-type: disc; padding-left: 20px;">
  <li style="margin-bottom: 1em;">
    <strong>Rarefacci√≥n y cobertura:</strong> se generan curvas que muestran c√≥mo aumenta el n√∫mero de especies observadas a medida que incrementamos el n√∫mero de secuencias analizadas. Estas curvas son una herramienta clave para evaluar si la profundidad de muestreo es suficiente. 
    <ul>
      <li>Si las curvas tienden a estabilizarse, significa que con el n√∫mero de lecturas disponibles ya hemos capturado la mayor parte de la diversidad.</li>
      <li>Si las curvas contin√∫an ascendiendo sin llegar a un punto de saturaci√≥n, implica que el muestreo podr√≠a ser insuficiente y que probablemente se est√° perdiendo parte de la diversidad real.</li>
    </ul>
    Esta comprobaci√≥n inicial es crucial, pues asegura que los an√°lisis posteriores (diversidad alfa y beta) se interpretan de manera robusta y sin sesgos debidos a un muestreo desigual.
  </li>
  
  <li style="margin-bottom: 1em;">
    <strong>Diversidad alfa:</strong> hace referencia a la diversidad dentro de cada muestra individual. Existen distintos √≠ndices que capturan diferentes aspectos:
    <ul>
      <li><em>Riqueza observada:</em> n√∫mero total de taxones detectados en la muestra.</li>
      <li><em>√çndice de Shannon:</em> combina riqueza y equidad, reflejando tanto cu√°ntos taxones hay como qu√© tan uniformes son sus abundancias.</li>
      <li><em>Equidad (evenness):</em> mide la uniformidad en la distribuci√≥n de abundancias; una comunidad con todos los taxones presentes en proporciones similares es m√°s equitativa que una dominada por pocos.</li>
      <li><em>Diversidad filogen√©tica de Faith:</em> a√±ade la dimensi√≥n evolutiva, considerando la distancia filogen√©tica entre los organismos detectados.</li>
    </ul>
    Estas m√©tricas permiten comparar si ciertas condiciones experimentales promueven comunidades m√°s diversas, m√°s dominadas o m√°s filogen√©ticamente ricas que otras.
  </li>
  
  <li style="margin-bottom: 1em;">
    <strong>Diversidad beta:</strong> estudia las diferencias entre comunidades, comparando c√≥mo var√≠a la composici√≥n microbiana entre las distintas muestras o grupos de estudio. Se basa en c√°lculos de distancia o disimilitud, entre los que destacan:
    <ul>
      <li><em>Bray‚ÄìCurtis:</em> sensible a las abundancias relativas de los taxones.</li>
      <li><em>Jaccard:</em> centrado √∫nicamente en presencia o ausencia de taxones.</li>
      <li><em>UniFrac no ponderado:</em> incorpora la filogenia pero sin considerar las abundancias.</li>
      <li><em>UniFrac ponderado:</em> a√±ade informaci√≥n de abundancia a la distancia filogen√©tica.</li>
    </ul>
    Con estas m√©tricas podremos visualizar agrupamientos de muestras, por ejemplo, mediante an√°lisis de coordenadas principales (PCoA), y evaluar si las comunidades se estructuran de acuerdo con las condiciones experimentales o factores biol√≥gicos estudiados.
  </li>
</ul>

<p>
  El recorrido de esta secci√≥n seguir√° una l√≥gica progresiva. Primero, se comprobar√° la rarefacci√≥n y cobertura para confirmar que el muestreo no compromete la validez de los an√°lisis. Despu√©s, se abordar√° la diversidad alfa con el fin de detectar posibles diferencias dentro de cada muestra entre los grupos experimentales. Finalmente, se analizar√° la diversidad beta, donde buscaremos patrones de similitud o diferenciaci√≥n entre comunidades, apoy√°ndonos tanto en visualizaciones gr√°ficas como en an√°lisis estad√≠sticos complementarios.
</p>

<p>
  En conjunto, el estudio de la diversidad microbiana nos proporcionar√° una visi√≥n global de las comunidades, integrando aspectos de riqueza, equidad, filogenia y similitud entre muestras. Esto permitir√° contextualizar mejor los hallazgos taxon√≥micos y de abundancia diferencial presentados previamente, ofreciendo as√≠ una interpretaci√≥n m√°s completa de c√≥mo se estructuran y responden las comunidades microbianas a los factores investigados.
</p>










<div style="height: 20px; background-color: transparent;"></div>

<div class="titulo2" id="tab3-seccion6.1">
  6.1. Curvas de rarefacci√≥n y cobertura
</div>

<p>
  El an√°lisis de rarefacci√≥n y cobertura permite evaluar si la profundidad de muestreo alcanzada en cada muestra es suficiente para capturar de manera representativa la diversidad microbiana. A trav√©s de curvas de rarefacci√≥n se observa c√≥mo se incrementa la diversidad estimada al aumentar el n√∫mero de lecturas consideradas. Si estas curvas tienden a estabilizarse, podemos concluir que el muestreo es adecuado; de lo contrario, existe riesgo de que parte de la diversidad quede sin detectar.
</p>

<p>
  El archivo <code>alpha-rarefaction.qzv</code>, el cu√°l se encuentra disponible en el siguiente directorio:
</p>  

```{r, results="asis"}
if (file.exists(ruta_alpha_rarefaction_qzv)) {
  cat(glue::glue('
<code>{ruta_alpha_rarefaction_qzv}</code>
\n\n'))

} else {
  cat(glue::glue('
  <div class="alert-box">
    ‚ö†Ô∏è El archivo <code>alpha-rarefaction.qzv</code> no existe en la ruta especificada: 
    <code>{ruta_alpha_rarefaction_qzv}</code>
  </div>
\n\n'))
}
```

<p>
  Proporciona esta informaci√≥n en formato interactivo mediante un <code>index.html</code>, donde se visualizan tres gr√°ficos principales correspondientes a diferentes m√©tricas de diversidad alfa:
</p>

<ul>
  <li><strong>Diversidad de Shannon</strong>: refleja simult√°neamente riqueza y equidad.</li>
  <li><strong>N√∫mero de caracter√≠sticas observadas</strong>: mide la riqueza como n√∫mero de taxones detectados.</li>
  <li><strong>Diversidad filogen√©tica de Faith</strong>: incorpora la distancia evolutiva entre los taxones observados.</li>
</ul>

<p>
  Podemos explorar dichos gr√°ficos de forma interactiva mediante el siguiente <code>iframe</code> o abrilo en una pesta√±a nueva para explorar dicho informe de forma m√°s c√≥moda.
</p>

```{r, results='asis'}
# Generar iframe para Quarto si existe index.html
if (file.exists(ruta_index_html)) {

  cat(glue::glue('
  <iframe src="{ruta_index_html}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{ruta_index_html}" target="_blank" class="boton-iframe">
      üìä Abrir informe en nueva pesta√±a
    </a>
  </p>

  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">El √°rbol sin ra√≠z no est√° disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el archivo <code>index.html</code> correspondiente. <br>
      Aseg√∫rese de haber generado y descomprimido el archivo <code>alpha-rarefaction.qzv</code>.
    </span>
  </div>
  \n\n'))
}
```

<p>
  Adem√°s del componente visual, el an√°lisis genera archivos de datos en formato <code>.csv</code> que permiten explorar en detalle los valores exactos empleados en cada curva:
</p>

<ul>
  <li><code>shannon.csv</code>: valores del √≠ndice de Shannon a diferentes profundidades de rarefacci√≥n para cada muestra.</li>
  <li><code>observed_features.csv</code>: n√∫mero de taxones observados en cada punto de rarefacci√≥n.</li>
  <li><code>faith_pd.csv</code>: estimaci√≥n de diversidad filogen√©tica de Faith a lo largo de las profundidades de muestreo.</li>
</ul>

<p>
  A continuaci√≥n se analizan en detalle estos archivos, explicando qu√© representa cada uno y mostrando sus datos en formato de tabla din√°mica.
</p>






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Archivo <code>shannon.csv</code>
</div>


<p>
  Este archivo contiene los valores del √≠ndice de Shannon calculados para cada muestra en diferentes profundidades de rarefacci√≥n. El √≠ndice de Shannon combina riqueza (n√∫mero de taxones) y equidad (uniformidad en sus abundancias), de manera que valores m√°s altos indican comunidades m√°s diversas y equilibradas. Analizar c√≥mo evoluciona este √≠ndice al incrementar el n√∫mero de lecturas nos permite identificar el punto en que la diversidad deja de crecer significativamente, se√±al de que el esfuerzo de muestreo fue suficiente.
</p>

```{r}
# Leer el archivo y mostrar tabla interactiva
if (file.exists(ruta_shannon_csv)) {
  library(readr)
  shannon <- read_csv(ruta_shannon_csv, comment = "#", show_col_types = FALSE)

  # Tabla interactiva
  library(DT)
  library(htmltools)
  htmltools::div(
    class = "scroll-y-max-500",
    DT::datatable(
      shannon,
      options = list(
        scrollX = TRUE,
        paging = FALSE,
        lengthChange = FALSE,
        language = list(
          url = '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
        )
      ),
      class = 'stripe hover compact'
    )
  )

} else {
  cat(glue::glue('
  <div class="alert-box">
    ‚ö†Ô∏è El archivo <code>shannon.csv</code> no existe en la ruta especificada: 
    <code>{ruta_shannon_csv}</code>
  </div>
\n\n'))
}
```

```{r, results='asis'}
if (file.exists(ruta_shannon_csv)) {

  cat(glue::glue('
  <p style="text-align:center;">
    <a href="{ruta_shannon_csv}" target="_blank" class="boton-file">
      üíæ¬†Descargar archivo "shannon.csv" original
    </a>
  </p>
  \n\n'))
}
```






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Archivo <code>observed_features.csv</code>
</div>

<p>
  Este archivo muestra el n√∫mero de taxones distintos detectados en cada muestra seg√∫n la profundidad de muestreo. Es una medida directa de la riqueza observada, sin ponderar equidad ni relaciones filogen√©ticas. Su utilidad radica en comprobar si el n√∫mero de taxones tiende a estabilizarse con el incremento de secuencias; una estabilizaci√≥n implica que la mayor parte de la diversidad ya ha sido capturada, mientras que una curva ascendente sugiere un muestreo insuficiente.
</p>

```{r}
# Leer el archivo y mostrar tabla interactiva
if (file.exists(ruta_observed_features_csv)) {
  library(readr)
  observed_features <- read_csv(ruta_observed_features_csv, comment = "#", show_col_types = FALSE)

  # Tabla interactiva
  library(DT)
  library(htmltools)
  htmltools::div(
    class = "scroll-y-max-500",
    DT::datatable(
      observed_features,
      options = list(
        scrollX = TRUE,
        paging = FALSE,
        lengthChange = FALSE,
        language = list(
          url = '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
        )
      ),
      class = 'stripe hover compact'
    )
  )

} else {
  cat(glue::glue('
  <div class="alert-box">
    ‚ö†Ô∏è El archivo <code>observed_features.csv</code> no existe en la ruta especificada: 
    <code>{ruta_observed_features_csv}</code>
  </div>
\n\n'))
}
```

```{r, results='asis'}
if (file.exists(ruta_observed_features_csv)) {

  cat(glue::glue('
  <p style="text-align:center;">
    <a href="{ruta_observed_features_csv}" target="_blank" class="boton-file">
      üíæ¬†Descargar archivo "observed_features.csv" original
    </a>
  </p>
  \n\n'))
}
```






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Archivo <code>faith_pd.csv</code>
</div>

<p>
  Este archivo contiene los valores del √≠ndice de diversidad filogen√©tica de Faith, que suma las longitudes de las ramas del √°rbol filogen√©tico que abarcan los taxones presentes en cada muestra. A diferencia de las m√©tricas anteriores, este √≠ndice incorpora la historia evolutiva, de modo que no solo importa el n√∫mero de taxones, sino tambi√©n cu√°n diferentes son entre s√≠ desde el punto de vista filogen√©tico. Al analizar su evoluci√≥n con la rarefacci√≥n, podemos evaluar si la diversidad evolutiva de las comunidades est√° adecuadamente representada con la profundidad de secuenciaci√≥n disponible.
</p>

```{r}
# Leer el archivo y mostrar tabla interactiva
if (file.exists(ruta_faith_pd_csv)) {
  library(readr)
  faith_pd <- read_csv(ruta_faith_pd_csv, comment = "#", show_col_types = FALSE)

  # Tabla interactiva
  library(DT)
  library(htmltools)
  htmltools::div(
    class = "scroll-y-max-500",
    DT::datatable(
      faith_pd,
      options = list(
        scrollX = TRUE,
        paging = FALSE,
        lengthChange = FALSE,
        language = list(
          url = '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
        )
      ),
      class = 'stripe hover compact'
    )
  )

} else {
  cat(glue::glue('
  <div class="alert-box">
    ‚ö†Ô∏è El archivo <code>faith_pd.csv</code> no existe en la ruta especificada: 
    <code>{ruta_faith_pd_csv}</code>
  </div>
\n\n'))
}
```

```{r, results='asis'}
if (file.exists(ruta_faith_pd_csv)) {

  cat(glue::glue('
  <p style="text-align:center;">
    <a href="{ruta_faith_pd_csv}" target="_blank" class="boton-file">
      üíæ¬†Descargar archivo "faith_pd.csv" original
    </a>
  </p>
  \n\n'))
}
```

<p>
  La interpretaci√≥n conjunta de estos resultados permite confirmar si las curvas han alcanzado un punto de saturaci√≥n y, por tanto, si el esfuerzo de secuenciaci√≥n es adecuado para el an√°lisis posterior de diversidad alfa y beta. Esto garantiza que las comparaciones entre muestras no estar√°n sesgadas por diferencias en la profundidad de muestreo.
</p>










<div style="height: 20px; background-color: transparent;"></div>

<div class="titulo2" id="tab3-seccion6.2">
  6.2. Diversidad alfa (dentro de muestras)
</div>

<p>
  La <strong>diversidad alfa</strong> es un concepto fundamental en ecolog√≠a microbiana que describe la variabilidad y complejidad de una comunidad dentro de una muestra individual. A diferencia de la <em>diversidad beta</em>, que compara comunidades entre muestras o grupos, la diversidad alfa se centra en la riqueza (n√∫mero de taxones presentes) y la equidad (qu√© tan homog√©nea es la distribuci√≥n de abundancias entre esos taxones) de una comunidad microbiana particular. Evaluar la diversidad alfa permite responder preguntas clave: ¬øqu√© tan compleja es cada muestra? ¬øexisten diferencias de riqueza y uniformidad entre condiciones experimentales? ¬ølos tratamientos aplicados o los distintos grupos de estudio provocan un enriquecimiento, empobrecimiento o un cambio en la estructura de la comunidad?
</p>

<p>
  La importancia de este an√°lisis reside en que ofrece una medida sint√©tica del estado ecol√≥gico de cada muestra. Una alta diversidad alfa suele estar asociada a comunidades m√°s estables y resilientes, mientras que valores bajos pueden indicar p√©rdida de taxones, dominancia de unos pocos o incluso una reducci√≥n de la funcionalidad del ecosistema microbiano. Adem√°s, el an√°lisis de diversidad alfa es un paso previo necesario para interpretar correctamente las comparaciones posteriores entre grupos de muestras, ya que nos brinda un punto de referencia sobre la complejidad interna de cada comunidad antes de analizar su similitud o diferencia con otras.
</p>

<p>
  En esta secci√≥n se trabajar√° con los resultados producidos por el an√°lisis de <code>core-metrics</code> en QIIME 2, que genera autom√°ticamente varias m√©tricas de diversidad alfa. Estos resultados se encuentran en la carpeta <code>core-metrics-results</code> dentro de la carpeta de an√°lisis, en el siguiente directorio:
</p>

```{r, results="asis"}
if (file.exists(ruta_alpha_rarefaction_qzv)) {
  cat(glue::glue('
<code>{ruta_core_metrics_results}</code>
\n\n'))

} else {
  cat(glue::glue('
  <div class="alert-box">
    ‚ö†Ô∏è La carpeta <code>core-metrics-results/code> no existe en la ruta especificada: 
    <code>{ruta_core_metrics_results}</code>
  </div>
\n\n'))
}
```

<p>
  Cada m√©trica viene representada en dos tipos de archivos principales:
</p>

<ul>
  <li><code>.qza</code>: archivos de datos que contienen los valores calculados por muestra (vectores num√©ricos de diversidad).</li>
  <li><code>.qzv</code>: archivos de visualizaci√≥n que permiten explorar de forma interactiva los resultados mediante boxplots y pruebas estad√≠sticas de significancia entre grupos definidos en la metadata.</li>
</ul>

<p>
  En concreto, se trabajar√° con cuatro m√©tricas principales, cada una con un significado ecol√≥gico distinto:
</p>

<ul>
  <li><strong>Shannon</strong>: √≠ndice que combina riqueza y equidad, proporcionando una medida de la diversidad efectiva que penaliza la dominancia de unos pocos taxones.</li>
  <li><strong>Faith PD</strong>: incorpora informaci√≥n filogen√©tica, midiendo la suma de las longitudes de las ramas del √°rbol evolutivo presentes en cada muestra.</li>
  <li><strong>Evenness</strong>: refleja el grado de uniformidad en la distribuci√≥n de abundancias; valores altos implican que los taxones tienen abundancias similares.</li>
  <li><strong>Observed features</strong>: mide la riqueza pura, es decir, el n√∫mero de taxones distintos observados en la muestra sin considerar abundancia relativa ni filogenia.</li>
</ul>

<p>
  Los archivos espec√≠ficos que se emplear√°n son los siguientes:
</p>

<ul>
  <li><code>shannon_vector.qza</code> y <code>shannon-group-significance.qzv</code> (√≠ndice de Shannon y su comparaci√≥n entre grupos).</li>
  <li><code>faith_pd_vector.qza</code> y <code>faith-pd-group-significance.qzv</code> (diversidad filogen√©tica de Faith y comparaciones entre grupos).</li>
  <li><code>evenness_vector.qza</code> y <code>evenness-group-significance.qzv</code> (evenness por muestra y visualizaci√≥n por grupos).</li>
  <li><code>observed_features_vector.qza</code> y <code>observed-features-group-significance.qzv</code>(riqueza observada y su visualizaci√≥n por grupos).</li>
</ul>

<p>
  En el informe, la estrategia de presentaci√≥n ser√° uniforme: primero se mostrar√° la visualizaci√≥n oficial contenida en los archivos <code>.qzv</code> (incrustando el <code>index.html</code> correspondiente), despu√©s se comentar√° su interpretaci√≥n biol√≥gica y finalmente, en el caso que se considere necesario, se podr√° incrustar alguna tabla de valores derivados de los <code>.qza</code> o de los <code>.csv</code> internos para que el lector pueda explorar los resultados de manera detallada. De este modo, el informe no solo reproducir√° el output del pipeline, sino que lo complementar√° con explicaciones claras y tablas interactivas que aportan transparencia y facilitan la interpretaci√≥n.
</p>

<p>
  Una vez comentado esto, se procede a detallar m√©trica por m√©trica, explicando qu√© mide cada √≠ndice, c√≥mo se representan los resultados en QIIME 2 y qu√© conclusiones preliminares pueden obtenerse de cada caso.
</p>








<div style="height: 15px; background-color: transparent;"></div>

<div class="titulo3" id="tab3-seccion6.2.1">
  6.2.1. √çndice de Shannon (riqueza + equidad)
</div>

<p>
  El √≠ndice de <strong>Shannon</strong> es una de las m√©tricas cl√°sicas en ecolog√≠a y un referente en el an√°lisis de diversidad microbiana porque combina en un solo valor dos componentes clave: la <em>riqueza</em> y la <em>equidad</em>. La riqueza se refiere al n√∫mero de taxones distintos presentes en una muestra, mientras que la equidad mide c√≥mo se distribuyen las abundancias entre esos taxones. Una comunidad con muchas especies diferentes, pero dominada por un √∫nico tax√≥n muy abundante, tendr√° un valor de Shannon m√°s bajo que otra comunidad con el mismo n√∫mero de especies pero con abundancias repartidas de manera m√°s uniforme. Por ello, este √≠ndice nos permite obtener una visi√≥n m√°s matizada de la diversidad que simplemente contar el n√∫mero de taxones.
</p>

<p>
  Desde un punto de vista ecol√≥gico, <strong>valores altos del √≠ndice de Shannon</strong> se asocian a <strong>comunidades m√°s complejas y equilibradas</strong>. Esto puede interpretarse como una se√±al de estabilidad, resiliencia y potencial funcional elevado dentro del ecosistema microbiano. En cambio, valores bajos sugieren comunidades con menor complejidad, bien porque presentan una baja riqueza (pocos taxones) o porque est√°n dominadas por unos pocos que concentran la mayor parte de las abundancias. Esta situaci√≥n puede reflejar procesos de estr√©s, perturbaci√≥n ambiental o condiciones que favorecen la expansi√≥n de organismos espec√≠ficos en detrimento de la diversidad global.
</p>

<p>
  En nuestro an√°lisis, la informaci√≥n asociada a Shannon est√° contenida en dos archivos generados por QIIME 2. El primero, <code>shannon_vector.qza</code>, almacena los valores calculados para cada muestra de forma num√©rica. El segundo, <code>shannon-group-significance.qzv</code>, ofrece una visualizaci√≥n interactiva que facilita la interpretaci√≥n de los resultados. Esta visualizaci√≥n incluye diagramas de caja que comparan los valores de Shannon entre los distintos grupos definidos en la metadata, adem√°s de tablas de estad√≠sticas descriptivas y <strong>pruebas de significancia como Kruskal‚ÄìWallis</strong> o <strong>comparaciones m√∫ltiples</strong> corregidas por el <strong>m√©todo de Benjamini‚ÄìHochberg</strong>. De esta forma, no solo se pueden observar las tendencias generales, sino tambi√©n evaluar si las diferencias entre grupos son estad√≠sticamente relevantes.
</p>

```{r, results='asis'}
# Generar iframe para Quarto si existe index.html
if (file.exists(indices_html$`shannon-group-significance`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`shannon-group-significance`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`shannon-group-significance`}" target="_blank" class="boton-iframe">
      üìä Abrir informe en nueva pesta√±a
    </a>
  </p>

  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">El √°rbol sin ra√≠z no est√° disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el archivo <code>index.html</code> correspondiente. <br>
      Aseg√∫rese de haber generado y descomprimido el archivo <code>shannon-group-significance.qzv</code>.
    </span>
  </div>
  \n\n'))
}
```


<p>
  Al explorar la gr√°fica, conviene atender a varios aspectos: la mediana de cada grupo (que refleja el valor central de diversidad), la amplitud de la caja (indicativa de la variabilidad interna entre muestras) y la presencia de valores at√≠picos. Diferencias notables entre las medianas de los grupos, acompa√±adas de un valor p significativo en las pruebas estad√≠sticas, sugieren que la condici√≥n experimental est√° influyendo en la diversidad microbiana de manera consistente. Por ejemplo, si un grupo experimental muestra valores de Shannon significativamente m√°s altos, puede interpretarse como un efecto positivo del tratamiento en la complejidad de la comunidad. Si ocurre lo contrario, podr√≠a se√±alar una p√©rdida de diversidad posiblemente ligada a estr√©s o a una simplificaci√≥n de la comunidad. Cuando los valores son similares entre grupos, se concluye que, al menos en t√©rminos de riqueza y equidad, no se aprecian efectos detectables.
</p>

<p>
  En resumen, el an√°lisis de Shannon aporta una primera lectura s√≥lida sobre la diversidad alfa de las muestras. Nos permite identificar patrones generales en la distribuci√≥n de taxones y evaluar si las condiciones experimentales promueven comunidades m√°s equilibradas o, por el contrario, reducen la heterogeneidad interna. Estos resultados, junto con los obtenidos a partir de otras m√©tricas de diversidad alfa, constituir√°n una base fundamental para interpretar la estabilidad y funcionalidad potencial de las comunidades microbianas estudiadas.
</p>








<div style="height: 15px; background-color: transparent;"></div>

<div class="titulo3" id="tab3-seccion6.2.2">
  6.2.2. Diversidad filogen√©tica de Faith (longitud de ramas evolutivas)
</div>

<p>
  El √≠ndice de <strong>Diversidad Filogen√©tica de Faith (Faith PD)</strong> es una m√©trica que incorpora expl√≠citamente la <em>historia evolutiva</em> de los organismos presentes en la comunidad microbiana. A diferencia de otros √≠ndices que se basan √∫nicamente en el n√∫mero de taxones o en la distribuci√≥n de sus abundancias, Faith PD cuantifica la <strong>longitud total de las ramas del √°rbol filogen√©tico</strong> que conectan a todos los taxones observados en una muestra. De este modo, no solo refleja la riqueza en t√©rminos de cu√°ntos taxones diferentes est√°n presentes, sino tambi√©n cu√°n diversos son desde un punto de vista evolutivo.
</p>

<p>
  Este enfoque resulta especialmente valioso en microbiomas, ya que dos comunidades pueden tener un n√∫mero similar de taxones, pero muy distinta diversidad filogen√©tica. Por ejemplo, una muestra que contiene varias especies estrechamente relacionadas (pertenecientes a un mismo linaje) tendr√° un Faith PD relativamente bajo, mientras que otra con especies filogen√©ticamente distantes (pertenecientes a diferentes filos) mostrar√° un valor m√°s alto. As√≠, esta m√©trica nos ayuda a responder preguntas sobre la <strong>complejidad funcional potencial</strong> de una comunidad: comunidades con mayor diversidad filogen√©tica tienden a incluir un rango m√°s amplio de capacidades metab√≥licas y ecol√≥gicas.
</p>

<p>
  En nuestro an√°lisis, esta informaci√≥n est√° contenida en dos archivos principales generados por QIIME 2. El primero, <code>faith_pd_vector.qza</code>, almacena los valores num√©ricos de diversidad filogen√©tica para cada muestra individual. El segundo, <code>faith-pd-group-significance.qzv</code>, permite explorar estos resultados de manera interactiva, mostrando diagramas de caja que comparan los valores entre los grupos definidos en la metadata, as√≠ como tablas de significancia estad√≠stica. Estas comparaciones se realizan mediante <strong>pruebas de hip√≥tesis no param√©tricas</strong> como Kruskal‚ÄìWallis, y en caso de diferencias significativas, incluyen comparaciones m√∫ltiples entre pares de grupos, ajustadas para controlar la tasa de falsos descubrimientos.
</p>

```{r, results='asis'}
# Generar iframe para Quarto si existe index.html
if (file.exists(indices_html$`faith-pd-group-significance`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`faith-pd-group-significance`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`faith-pd-group-significance`}" target="_blank" class="boton-iframe">
      üìä Abrir informe en nueva pesta√±a
    </a>
  </p>

  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">La visualizaci√≥n no est√° disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el archivo <code>index.html</code> correspondiente. <br>
      Aseg√∫rese de haber generado y descomprimido el archivo <code>faith-pd-group-significance.qzv</code>.
    </span>
  </div>
  \n\n'))
}
```

<p>
  La interpretaci√≥n de esta m√©trica debe hacerse considerando tanto la magnitud de los valores como las diferencias entre grupos. <strong>Valores altos de Faith PD</strong> indican comunidades que abarcan una mayor diversidad evolutiva, lo que suele asociarse con un <em>potencial funcional m√°s amplio</em> y con ecosistemas m√°s resilientes frente a cambios ambientales. Por el contrario, <strong>valores bajos</strong> sugieren que la comunidad est√° formada por linajes cercanos entre s√≠, lo que puede reflejar condiciones restrictivas o un entorno que favorece la proliferaci√≥n de grupos espec√≠ficos. Si los diagramas de caja muestran diferencias claras entre grupos, respaldadas por significancia estad√≠stica, se podr√° concluir que la variable experimental est√° modulando no solo la composici√≥n, sino tambi√©n la amplitud filogen√©tica de la comunidad. En ausencia de diferencias, la interpretaci√≥n ser√≠a que, pese a posibles cambios en abundancia relativa de taxones, la diversidad filogen√©tica global se mantiene estable.
</p>

<p>
  En conjunto, el an√°lisis de Faith PD complementa al √≠ndice de Shannon y a otras m√©tricas alfa, ya que introduce la dimensi√≥n evolutiva en la evaluaci√≥n de la diversidad. Esta perspectiva nos permite entender no solo cu√°ntos taxones hay y c√≥mo se distribuyen, sino tambi√©n <strong>qu√© tan amplia es la representaci√≥n filogen√©tica dentro de cada muestra</strong>. De este modo, se obtiene una visi√≥n m√°s completa sobre la estructura y potencial ecol√≥gico de las comunidades microbianas bajo estudio.
</p>








<div style="height: 15px; background-color: transparent;"></div>

<div class="titulo3" id="tab3-seccion6.2.3">
  6.2.3. Evenness (uniformidad de abundancias)
</div>

<p>
  La m√©trica de <strong>Evenness</strong>, tambi√©n conocida como <em>uniformidad</em>, se centra en evaluar c√≥mo se distribuyen las abundancias de los taxones dentro de una comunidad microbiana. A diferencia de otros √≠ndices que combinan riqueza y equidad, la Evenness se concentra exclusivamente en la segunda dimensi√≥n: la <strong>proporci√≥n relativa entre los taxones presentes</strong>. En t√©rminos simples, nos indica hasta qu√© punto los taxones comparten de manera equilibrada la abundancia total de la comunidad.
</p>

<p>
  Una comunidad con una <strong>alta uniformidad</strong> es aquella en la que las especies tienen abundancias similares, sin que ninguna domine en exceso. Este patr√≥n suele interpretarse como un signo de <em>estabilidad ecol√≥gica</em> y de interacci√≥n equilibrada entre los miembros del ecosistema. Por el contrario, una <strong>baja uniformidad</strong> refleja comunidades donde pocas especies concentran la mayor√≠a de la abundancia, lo que puede se√±alar procesos de estr√©s, desequilibrio o condiciones ambientales que favorecen a ciertos grupos sobre otros. En microbiomas, este tipo de situaciones puede estar asociado a estados de disbiosis o a entornos altamente selectivos.
</p>

<p>
  En nuestro caso, la evaluaci√≥n de la Evenness se deriva de dos archivos clave. El primero, <code>evenness_vector.qza</code>, contiene los valores calculados para cada muestra de manera individual, mientras que el segundo, <code>evenness-group-significance.qzv</code>, proporciona la visualizaci√≥n interactiva de estos datos en forma de diagramas de caja y tablas de significancia. Esta √∫ltima visualizaci√≥n permite comparar la uniformidad entre los distintos grupos definidos en la metadata y, mediante pruebas estad√≠sticas no param√©tricas, determinar si las diferencias observadas son significativas desde un punto de vista biol√≥gico.
</p>

```{r, results='asis'}
# Generar iframe para Quarto si existe index.html
if (file.exists(indices_html$`evenness-group-significance`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`evenness-group-significance`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`evenness-group-significance`}" target="_blank" class="boton-iframe">
      üìä Abrir informe en nueva pesta√±a
    </a>
  </p>

  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">La visualizaci√≥n no est√° disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el archivo <code>index.html</code> correspondiente. <br>
      Aseg√∫rese de haber generado y descomprimido el archivo <code>evenness-group-significance.qzv</code>.
    </span>
  </div>
  \n\n'))
}
```

<p>
  La interpretaci√≥n de esta m√©trica requiere observar tanto los valores absolutos como las comparaciones entre grupos. <strong>Valores altos de Evenness</strong> sugieren que la comunidad est√° estructurada de manera equilibrada, con taxones que coexisten sin grandes diferencias en abundancia relativa. <strong>Valores bajos</strong>, en cambio, evidencian un fuerte dominio de unos pocos taxones sobre el resto, lo que puede implicar vulnerabilidad del ecosistema ante perturbaciones externas. Cuando las visualizaciones muestran diferencias significativas entre los grupos experimentales, se puede concluir que la condici√≥n bajo estudio afecta a la <em>estructura interna</em> de la comunidad, no solo en t√©rminos de riqueza sino tambi√©n en la forma en que los taxones comparten el espacio ecol√≥gico.
</p>

<p>
  En conjunto, el an√°lisis de Evenness complementa las m√©tricas de Shannon y Faith PD, ofreciendo una perspectiva m√°s espec√≠fica sobre la equidad de la comunidad. De este modo, permite identificar si las diferencias detectadas en diversidad alfa responden principalmente a variaciones en la riqueza de taxones o bien a cambios en la uniformidad con la que estos se distribuyen en las muestras.
</p>








<div style="height: 15px; background-color: transparent;"></div>

<div class="titulo3" id="tab3-seccion6.2.4">
  6.2.4. Riqueza observada (Observed Features)
</div>

<p>
  La m√©trica de <strong>Observed Features</strong> corresponde a una de las formas m√°s directas y sencillas de evaluar la diversidad alfa en un microbioma: la <strong>riqueza pura</strong>. En este caso, no se considera c√≥mo se distribuyen las abundancias ni las relaciones filogen√©ticas entre los taxones, sino simplemente el <strong>n√∫mero de unidades taxon√≥micas observadas</strong> en cada muestra tras los procesos de normalizaci√≥n y rarefacci√≥n. Dichas unidades pueden corresponder a <em>ASVs</em> (amplicon sequence variants), <em>OTUs</em> (operational taxonomic units) u otras formas de clasificaci√≥n empleadas en el an√°lisis.
</p>

<p>
  Un <strong>valor alto</strong> de Observed Features refleja una muestra con mayor n√∫mero de taxones distintos detectados, lo que suele interpretarse como una se√±al de mayor <em>riqueza biol√≥gica</em>. Por el contrario, un <strong>valor bajo</strong> indica una comunidad con pocos taxones, posiblemente dominada por un n√∫mero limitado de organismos. Esta informaci√≥n resulta clave para identificar entornos donde la diversidad est√° restringida, ya sea por limitaciones ambientales, condiciones selectivas, procesos de estr√©s o estados de disbiosis en sistemas biol√≥gicos.
</p>

<p>
  En este an√°lisis contamos con el archivo <code>observed_features_vector.qza</code>, que contiene los valores num√©ricos de riqueza para cada muestra, y con el archivo <code>observed-features-group-significance.qzv</code>, que presenta la visualizaci√≥n interactiva en forma de diagramas de caja y tablas de comparaciones estad√≠sticas. Esta combinaci√≥n permite, por un lado, conocer los valores de riqueza individualmente y, por otro, explorar diferencias entre grupos experimentales de manera estad√≠sticamente fundamentada.
</p>

```{r, results='asis'}
# Generar iframe para Quarto si existe index.html
if (file.exists(indices_html$`observed-features-group-significance`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`observed-features-group-significance`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`observed-features-group-significance`}" target="_blank" class="boton-iframe">
      üìä Abrir informe en nueva pesta√±a
    </a>
  </p>

  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">La visualizaci√≥n no est√° disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el archivo <code>index.html</code> correspondiente. <br>
      Aseg√∫rese de haber generado y descomprimido el archivo <code>observed-features-group-significance.qzv</code>.
    </span>
  </div>
  \n\n'))
}
```

<p>
  La interpretaci√≥n de esta m√©trica se centra en detectar diferencias de riqueza entre las condiciones evaluadas. Cuando un grupo experimental muestra valores significativamente m√°s altos de Observed Features, puede interpretarse que las condiciones favorecen la colonizaci√≥n y coexistencia de un mayor n√∫mero de taxones. Por el contrario, valores m√°s bajos pueden sugerir un impacto negativo sobre la riqueza, posiblemente asociado a factores ambientales restrictivos o a la expansi√≥n de unos pocos taxones dominantes que limitan la diversidad total.
</p>

<p>
  En conjunto, esta m√©trica aporta una visi√≥n clara y sencilla de la riqueza microbiana sin matices adicionales, y complementa a los √≠ndices de Shannon, Faith PD y Evenness. De este modo, la combinaci√≥n de todas estas m√©tricas de diversidad alfa nos permite obtener un panorama integral: no solo del n√∫mero de taxones presentes, sino tambi√©n de su distribuci√≥n relativa y de su profundidad filogen√©tica, ofreciendo as√≠ una interpretaci√≥n m√°s s√≥lida y matizada de la estructura de las comunidades microbianas estudiadas.
</p>










<div style="height: 20px; background-color: transparent;"></div>

<div class="titulo2" id="tab3-seccion6.3">
  6.3. Diversidad beta (entre muestras)
</div>

<p>
  Una vez analizada la diversidad alfa, que describe la riqueza y equidad dentro de cada muestra, nos centramos ahora en la <strong>diversidad beta</strong>. Esta m√©trica permite comparar comunidades microbianas entre muestras o grupos, evaluando c√≥mo var√≠a la composici√≥n de especies entre diferentes condiciones experimentales o tratamientos. Mientras la diversidad alfa nos informa sobre la complejidad interna de cada muestra, la diversidad beta nos ayuda a entender la similitud o disimilitud entre las comunidades, proporcionando informaci√≥n cr√≠tica sobre la heterogeneidad y la estructura del ecosistema microbiano en conjunto.
</p>

<p>
  La diversidad beta se mide utilizando diferentes tipos de distancias entre muestras. Cada distancia captura un aspecto distinto de la comunidad microbiana: <strong>Bray‚ÄìCurtis</strong> eval√∫a diferencias basadas en abundancias relativas de taxones, <strong>Jaccard</strong> mide √∫nicamente la presencia o ausencia de taxones, <strong>Unweighted UniFrac</strong> incorpora la filogenia considerando presencia/ausencia, y <strong>Weighted UniFrac</strong> combina filogenia y abundancia relativa. Analizar estas distancias permite identificar agrupamientos de muestras similares, detectar valores at√≠picos y evaluar si las condiciones experimentales generan patrones consistentes de separaci√≥n entre grupos.
</p>

<p>
  Los resultados del an√°lisis se encuentran en la carpeta <code>core-metrics-results</code> dentro de la carpeta de an√°lisis, en el siguiente directorio:
</p>

```{r, results="asis"}
if (dir.exists(ruta_core_metrics_results)) {
  cat(glue::glue('<code>{ruta_core_metrics_results}</code>\n\n'))
  
} else {
  cat(glue::glue('
  <div class="alert-box">
    ‚ö†Ô∏è La carpeta <code>core-metrics-results</code> no existe en la ruta especificada: 
    <code>{ruta_core_metrics_results}</code>
  </div>
\n\n'))
}
```

<p>
  Para cada tipo de distancia se generan tres tipos de archivos principales: matrices de distancia (<code>.qza</code>), resultados de PCoA (<code>.qza</code>) y visualizaciones interactivas tipo EMPeror (<code>.qzv</code>). Los archivos <code>.qza</code> contienen la informaci√≥n num√©rica necesaria para calcular la similitud entre muestras y derivar coordenadas PCoA, mientras que los <code>.qzv</code> permiten explorar gr√°ficamente la separaci√≥n de grupos de manera interactiva.
</p>

<p>
  En detalle, se emplear√°n las siguientes m√©tricas de diversidad beta:
</p>

<ul style="list-style-type: disc; padding-left: 20px;">
  <li style="margin-bottom: 1em;">
    <p><strong>Distancia de Bray‚ÄìCurtis</strong>: esta m√©trica eval√∫a las diferencias entre comunidades bas√°ndose en las abundancias relativas de los taxones presentes en cada muestra. Es especialmente √∫til para detectar cambios en la composici√≥n cuando la abundancia de ciertos taxones domina la comunidad.</p>
    <ul style="list-style-type: none; padding-left: 20px;">
      <li>‚Üí <strong>Archivos de visualizaci√≥n</strong>: <code>bray_curtis_emperor.qzv</code>, <code>bray-curtis-emperor-Type.qzv</code></li>
      <li>‚Üí <strong>Archivos num√©ricos</strong>: <code>bray_curtis_distance_matrix.qza</code>, <code>bray_curtis_pcoa_results.qza</code></li>
    </ul>
  </li>

  <li style="margin-bottom: 1em;">
    <p><strong>Distancia de Jaccard</strong>: mide la disimilitud entre comunidades considerando √∫nicamente la presencia o ausencia de taxones, ignorando sus abundancias. Es √∫til para identificar cambios en la composici√≥n de especies sin que influyan los taxones dominantes.</p>
    <ul style="list-style-type: none; padding-left: 20px;">
      <li>‚Üí <strong>Archivos de visualizaci√≥n</strong>: <code>jaccard_emperor.qzv</code></li>
      <li>‚Üí <strong>Archivos num√©ricos</strong>: <code>jaccard_distance_matrix.qza</code>, <code>jaccard_pcoa_results.qza</code></li>
    </ul>
  </li>

  <li style="margin-bottom: 1em;">
    <p><strong>Unweighted UniFrac</strong>: eval√∫a la diversidad filogen√©tica considerando la presencia o ausencia de taxones. Tiene en cuenta la distancia evolutiva entre taxones, lo que permite detectar diferencias filogen√©ticas entre comunidades.</p>
    <ul style="list-style-type: none; padding-left: 20px;">
      <li>‚Üí <strong>Archivos de visualizaci√≥n</strong>: <code>unweighted_unifrac_emperor.qzv</code>, <code>unweighted-unifrac-emperor-Type.qzv</code>, <code>unweighted-unifrac-Type-significance.qzv</code></li>
      <li>‚Üí <strong>Archivos num√©ricos</strong>: <code>unweighted_unifrac_distance_matrix.qza</code>, <code>unweighted_unifrac_pcoa_results.qza</code></li>
    </ul>
  </li>

  <li style="margin-bottom: 1em;">
    <p><strong>Weighted UniFrac</strong>: combina informaci√≥n filogen√©tica y abundancia relativa de taxones, proporcionando una visi√≥n m√°s completa de las diferencias entre comunidades al considerar tanto la presencia/ausencia como la proporci√≥n de cada tax√≥n.</p>
    <ul style="list-style-type: none; padding-left: 20px;">
      <li>‚Üí <strong>Archivos de visualizaci√≥n</strong>: <code>weighted_unifrac_emperor.qzv</code></li>
      <li>‚Üí <strong>Archivos num√©ricos</strong>: <code>weighted_unifrac_distance_matrix.qza</code>, <code>weighted_unifrac_pcoa_results.qza</code></li>
    </ul>
  </li>
</ul>

<p>
  En el informe, la estrategia de presentaci√≥n ser√° uniforme: primero se mostrar√°n las visualizaciones interactivas contenidas en los archivos <code>.qzv</code> incrustando los <code>index.html</code> correspondientes para que el lector pueda explorar la separaci√≥n entre grupos y la posici√≥n de cada muestra en el espacio PCoA. Posteriormente se comentar√° la interpretaci√≥n biol√≥gica de cada m√©trica, explicando qu√© representa cada eje, la dispersi√≥n de las muestras y c√≥mo se reflejan las diferencias entre grupos experimentales. Opcionalmente se podr√°n incluir tablas con las coordenadas PCoA derivadas de los <code>.qza</code> para un an√°lisis m√°s detallado si se requiere.
</p>

<p>
  Una vez establecido este contexto general, se proceder√° a detallar cada m√©trica por separado: Bray‚ÄìCurtis, Jaccard, Unweighted UniFrac y Weighted UniFrac, describiendo su significado biol√≥gico, mostrando la visualizaci√≥n interactiva y comentando las principales conclusiones que se pueden extraer de cada an√°lisis.
</p>








<div style="height: 15px; background-color: transparent;"></div>

<div class="titulo3" id="tab3-seccion6.3.1">
  6.3.1. Distancia de Bray‚ÄìCurtis (abundancias relativas)
</div>

<p>
  La <strong>distancia de Bray‚ÄìCurtis</strong> es una m√©trica ampliamente utilizada para cuantificar las diferencias en la composici√≥n microbiana entre comunidades. Su c√°lculo se basa en las <em>abundancias relativas</em> de los taxones presentes en cada muestra, lo que la hace especialmente √∫til para detectar cambios en la estructura de la comunidad cuando ciertos taxones dominan frente a otros. 
</p>

<p>
  Desde una perspectiva ecol√≥gica, <strong>valores bajos de Bray‚ÄìCurtis</strong> indican que dos comunidades son similares en cuanto a sus abundancias relativas, mientras que <strong>valores altos reflejan composiciones muy diferentes</strong>. Esta m√©trica es sensible a los taxones dominantes, de modo que una comunidad con unos pocos taxones muy abundantes puede distinguirse fuertemente de otra aunque compartan muchos taxones raros. Por ello, resulta de gran valor para evaluar el efecto de condiciones experimentales sobre la estructura global de las comunidades microbianas.
</p>

<p>
  En nuestro an√°lisis, contamos con dos visualizaciones complementarias en formato <code>.qzv</code>, que permiten explorar los resultados de Bray‚ÄìCurtis mediante an√°lisis de coordenadas principales (PCoA) en el entorno interactivo de QIIME 2.
</p>






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Visualizaci√≥n 1: <code>bray_curtis_emperor.qzv</code>
</div>

<p>
  Este archivo presenta un PCoA tridimensional donde cada punto representa una muestra y la distancia entre puntos refleja su grado de similitud seg√∫n la m√©trica de Bray‚ÄìCurtis. La herramienta <strong>Emperor</strong> permite rotar el gr√°fico, resaltar muestras y explorar la estructura general de los datos. Es especialmente √∫til para detectar patrones globales, como la agrupaci√≥n de muestras en funci√≥n de su composici√≥n relativa, sin aplicar todav√≠a ning√∫n factor de la metadata.
</p>

```{r, results='asis'}
if (file.exists(indices_html$`bray_curtis_emperor`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`bray_curtis_emperor`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`bray_curtis_emperor`}" target="_blank" class="boton-iframe">
      üìä Abrir informe en nueva pesta√±a
    </a>
  </p>
  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">Visualizaci√≥n no disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el archivo <code>index.html</code> correspondiente. <br>
      Aseg√∫rese de haber generado y descomprimido <code>bray_curtis_emperor.qzv</code>.
    </span>
  </div>
  \n\n'))
}
```






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Visualizaci√≥n 2: <code>bray-curtis-emperor-Type.qzv</code>
</div>

<p>
  A diferencia de la primera, esta visualizaci√≥n incorpora la variable experimental <code>Type</code>, permitiendo colorear y agrupar las muestras seg√∫n esa categor√≠a. Esto facilita evaluar de forma inmediata si los grupos definidos por la metadata se separan en el espacio multivariado. Una separaci√≥n clara entre grupos sugiere que la variable experimental est√° ejerciendo un efecto fuerte sobre la estructura microbiana, mientras que una superposici√≥n amplia indicar√≠a que la variable no explica gran parte de la variaci√≥n observada.
</p>

```{r, results='asis'}
if (file.exists(indices_html$`bray-curtis-emperor-Type`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`bray-curtis-emperor-Type`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`bray-curtis-emperor-Type`}" target="_blank" class="boton-iframe">
      üìä Abrir informe en nueva pesta√±a
    </a>
  </p>
  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">Visualizaci√≥n no disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el archivo <code>index.html</code> correspondiente. <br>
      Aseg√∫rese de haber generado y descomprimido <code>bray-curtis-emperor-Type.qzv</code>.
    </span>
  </div>
  \n\n'))
}
```






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ <code>Archivos num√©ricos</code>
</div>

<p>
  Adem√°s de las visualizaciones interactivas, QIIME 2 genera archivos <code>.qza</code> que contienen la informaci√≥n num√©rica subyacente:
</p>

<ul style="list-style-type: none; padding-left: 20px;">
  <li>‚Üí <strong><code>bray_curtis_distance_matrix.qza</code></strong>: matriz de distancias entre todas las muestras, donde cada valor representa la disimilitud de Bray‚ÄìCurtis entre un par de comunidades.</li>
  <li>‚Üí <strong><code>bray_curtis_pcoa_results.qza</code></strong>: resultados num√©ricos del an√°lisis PCoA, incluyendo las coordenadas de cada muestra en el espacio multivariado y la varianza explicada por cada eje.</li>
</ul>

<p>
  Estos archivos son particularmente √∫tiles si se desea <strong>rean√°lisis en R o Python</strong>, realizar pruebas estad√≠sticas adicionales (por ejemplo, PERMANOVA) o generar visualizaciones personalizadas fuera del entorno de QIIME 2.
</p>

<p>
  En conjunto, el an√°lisis de Bray‚ÄìCurtis proporciona una primera visi√≥n s√≥lida sobre c√≥mo las comunidades microbianas se diferencian en t√©rminos de abundancia relativa de taxones. La combinaci√≥n de visualizaciones interactivas y datos num√©ricos permite tanto la exploraci√≥n gr√°fica como la validaci√≥n estad√≠stica, facilitando la interpretaci√≥n de los patrones de diversidad beta en relaci√≥n con la variable experimental estudiada.
</p>








<div style="height: 15px; background-color: transparent;"></div>

<div class="titulo3" id="tab3-seccion6.3.2">
  6.3.2. Distancia de Jaccard (presencia/ausencia)
</div>

<p>
  La <strong>distancia de Jaccard</strong> es una m√©trica que mide la disimilitud entre comunidades microbianas considerando √∫nicamente la <em>presencia o ausencia</em> de taxones, sin tener en cuenta sus abundancias relativas. De este modo, todas las especies tienen el mismo peso en el c√°lculo, independientemente de si son dominantes o raras. Esto la convierte en una herramienta clave para identificar <strong>cambios en la composici√≥n de especies</strong> cuando lo que interesa es saber si ciertos taxones aparecen o desaparecen entre condiciones experimentales, sin que las abundancias de los m√°s dominantes distorsionen la comparaci√≥n.
</p>

<p>
  Desde una perspectiva ecol√≥gica, <strong>valores bajos de Jaccard</strong> reflejan comunidades con un alto solapamiento en los taxones presentes, mientras que <strong>valores altos indican comunidades con composiciones muy distintas</strong>. Esta m√©trica resulta especialmente √∫til en escenarios donde los cambios cualitativos ‚Äîla presencia o ausencia de ciertos microorganismos‚Äî son m√°s relevantes que los cuantitativos.
</p>

<p>
  En nuestro an√°lisis, la m√©trica de Jaccard se representa a trav√©s de una visualizaci√≥n interactiva en formato <code>.qzv</code>, acompa√±ada de archivos num√©ricos que contienen la matriz de distancias y los resultados del an√°lisis de coordenadas principales (PCoA).
</p>






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Visualizaci√≥n: <code>jaccard_emperor.qzv</code>
</div>

<p>
  Este archivo muestra un PCoA tridimensional en el que cada punto corresponde a una muestra y la separaci√≥n entre puntos refleja su grado de disimilitud seg√∫n la m√©trica de Jaccard. A diferencia de otras m√©tricas basadas en abundancias, aqu√≠ solo importa qu√© taxones est√°n presentes o ausentes. La herramienta <strong>Emperor</strong> permite explorar estas diferencias de forma interactiva, rotando el gr√°fico y resaltando muestras para evaluar posibles agrupamientos. Esto es particularmente √∫til para observar patrones de composici√≥n microbiana donde la abundancia no es un factor determinante.
</p>

```{r, results='asis'}
if (file.exists(indices_html$`jaccard_emperor`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`jaccard_emperor`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`jaccard_emperor`}" target="_blank" class="boton-iframe">
      üìä Abrir informe en nueva pesta√±a
    </a>
  </p>
  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">Visualizaci√≥n no disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el archivo <code>index.html</code> correspondiente. <br>
      Aseg√∫rese de haber generado y descomprimido <code>jaccard_emperor.qzv</code>.
    </span>
  </div>
  \n\n'))
}
```






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ <code>Archivos num√©ricos</code>
</div>

<p>
  Adem√°s de la visualizaci√≥n, QIIME 2 genera los siguientes archivos <code>.qza</code> que contienen la informaci√≥n subyacente:
</p>

<ul style="list-style-type: none; padding-left: 20px;">
  <li>‚Üí <strong><code>jaccard_distance_matrix.qza</code></strong>: matriz de distancias basada en la m√©trica de Jaccard, donde cada valor representa el grado de disimilitud entre un par de muestras.</li>
  <li>‚Üí <strong><code>jaccard_pcoa_results.qza</code></strong>: resultados num√©ricos del an√°lisis PCoA, incluyendo las coordenadas de cada muestra en el espacio multivariado y el porcentaje de varianza explicada por cada eje.</li>
</ul>

<p>
  Estos archivos permiten realizar <strong>rean√°lisis estad√≠sticos en R o Python</strong>, como pruebas PERMANOVA o PERMDISP, y generar visualizaciones personalizadas que complementen las ofrecidas en el entorno de QIIME 2.
</p>

<p>
  En resumen, el an√°lisis de Jaccard aporta una perspectiva centrada en la <strong>composici√≥n cualitativa</strong> de las comunidades microbianas. A trav√©s de esta m√©trica podemos identificar si la variable experimental est√° influyendo en la mera presencia o ausencia de ciertos taxones, sin que la abundancia de los dominantes distorsione la interpretaci√≥n. As√≠, se convierte en un complemento ideal de m√©tricas basadas en abundancia como Bray‚ÄìCurtis, proporcionando una visi√≥n m√°s completa de la diversidad beta.
</p>








<div style="height: 15px; background-color: transparent;"></div>

<div class="titulo3" id="tab3-seccion6.3.3">
  6.3.3. Unweighted UniFrac (filogenia + presencia/ausencia)
</div>

<p>
  La m√©trica <strong>Unweighted UniFrac</strong> mide la disimilitud entre comunidades teniendo en cuenta la <em>historia evolutiva</em> de los taxones y considerando √∫nicamente su <strong>presencia o ausencia</strong>. A diferencia de las m√©tricas puramente taxon√≥micas (p. ej. Jaccard) que s√≥lo comparan conjuntos de taxones, Unweighted UniFrac pondera esas diferencias por la distancia filogen√©tica: la desaparici√≥n o aparici√≥n de un tax√≥n filogen√©ticamente lejano aporta m√°s a la distancia que cambios entre taxones muy cercanos.
</p>

<p>
  En t√©rminos ecol√≥gicos, Unweighted UniFrac es especialmente √∫til para detectar cambios en la <strong>estructura filogen√©tica</strong> de las comunidades ‚Äîpor ejemplo, sustituci√≥n de clados enteros o la aparici√≥n/desaparici√≥n de linajes evolutivamente distantes‚Äî, independientemente de si esos taxones son abundantes o no. Por tanto, es una m√©trica sensible a variaciones cualitativas de la composici√≥n que tengan significado evolutivo.
</p>

<p>
  Para explorar estos patrones disponemos de varias visualizaciones interactivas y de los archivos num√©ricos subyacentes generados por QIIME 2. A continuaci√≥n mostramos las visualizaciones (PCoA/Emperor) y explicamos qu√© aporta cada una.
</p>






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Visualizaci√≥n 1: <code>unweighted_unifrac_emperor.qzv</code>
</div>

<p>
  Este archivo contiene un PCoA interactivo basado en la distancia Unweighted UniFrac. Cada punto representa una muestra y la separaci√≥n entre puntos refleja la disimilitud filogen√©tica considerando presencia/ausencia de taxones. La vista de Emperor permite rotar el espacio, aislar muestras y examinar agrupamientos globales sin aplicar coloraci√≥n por variables experimentales; es ideal para una inspecci√≥n exploratoria de la estructura filogen√©tica del dataset en bruto.
</p>

```{r, results='asis'}
# Incrustar index.html si est√° disponible
if (file.exists(indices_html$`unweighted_unifrac_emperor`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`unweighted_unifrac_emperor`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`unweighted_unifrac_emperor`}" target="_blank" class="boton-iframe">
      üìä Abrir visualizaci√≥n Unweighted UniFrac en nueva pesta√±a
    </a>
  </p>

  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">Visualizaci√≥n no disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el <code>index.html</code> de <code>unweighted_unifrac_emperor.qzv</code>. 
      Aseg√∫rese de haber descomprimido el archivo <code>.qzv</code>.
    </span>
  </div>
  \n\n'))
}
```






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Visualizaci√≥n 2: <code>unweighted-unifrac-emperor-Type.qzv</code>
</div>

<p>
  Esta variante colorea y agrupa las muestras seg√∫n la variable <code>Type</code> (u otra columna de metadata que elija el analista). Al a√±adir la etiqueta experimental podemos inspeccionar si los grupos definidos por la metadata se separan en el espacio filogen√©tico: una separaci√≥n clara sugiere que la condici√≥n (Type) est√° asociada a cambios en la presencia/ausencia de linajes filogen√©ticos.
</p>

```{r, results='asis'}
if (file.exists(indices_html$`unweighted-unifrac-emperor-Type`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`unweighted-unifrac-emperor-Type`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`unweighted-unifrac-emperor-Type`}" target="_blank" class="boton-iframe">
      üìä Abrir Unweighted UniFrac (Type) en nueva pesta√±a
    </a>
  </p>

  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">Visualizaci√≥n no disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el <code>index.html</code> de <code>unweighted-unifrac-emperor-Type.qzv</code>. 
      Aseg√∫rese de haber generado y descomprimido correctamente el archivo.
    </span>
  </div>
  \n\n'))
}
```






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Visualizaci√≥n 3: <code>unweighted-unifrac-Type-significance.qzv</code>
</div>

<p>
  Este archivo proporciona resultados de pruebas de significancia asociadas a la separaci√≥n por <code>Type</code> (p. ej. PERMANOVA o pruebas de agrupamiento mostradas en la vista de QIIME2). Aqu√≠ podemos consultar p-values y comparaciones entre grupos que ayudan a discernir si la separaci√≥n observada en el PCoA es estad√≠sticamente s√≥lida o puede deberse al azar.
</p>

```{r, results='asis'}
if (file.exists(indices_html$`unweighted-unifrac-Type-significance`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`unweighted-unifrac-Type-significance`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`unweighted-unifrac-Type-significance`}" target="_blank" class="boton-iframe">
      üìä Abrir resultados de significancia (Unweighted UniFrac) en nueva pesta√±a
    </a>
  </p>

  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ö†Ô∏è <span style="font-size:14px;">No se encontr√≥ la visualizaci√≥n de significancia.</span><br>
    <span style="font-size:12px; font-weight:normal;">
      Si falta, se puede generar con <code>qiime diversity beta-group-significance</code> o reproducir la prueba en R (PERMANOVA).
    </span>
  </div>
  \n\n'))
}
```






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Archivos num√©ricos
</div>

<p>
  Los artefactos num√©ricos subyacentes son:
</p>

<ul style="list-style-type: none; padding-left: 20px;">
  <li>‚Üí <strong><code>unweighted_unifrac_distance_matrix.qza</code></strong>: matriz de distancias Unweighted UniFrac entre todas las muestras (cada celda es la disimilitud filogen√©tica por presencia/ausencia).</li>
  <li>‚Üí <strong><code>unweighted_unifrac_pcoa_results.qza</code></strong>: resultados del PCoA (coordenadas de cada muestra y varianza explicada por ejes), √∫tiles para an√°lisis cuantitativos y exportaci√≥n de tablas.</li>
</ul>

<p>
  Estos archivos permiten realizar an√°lisis estad√≠sticos complementarios fuera de QIIME 2, como <strong>PERMANOVA</strong> (adonis2) para probar si la variable de inter√©s explica una fracci√≥n significativa de la variaci√≥n entre muestras, o <strong>PERMDISP</strong> para comprobar homogeneidad de dispersi√≥n entre grupos. Tambi√©n facilitan la extracci√≥n de coordenadas PCoA para gr√°ficas personalizadas en <code>ggplot2</code> o la integraci√≥n con anotaciones adicionales de la metadata.
</p>

<p>
  En resumen, Unweighted UniFrac es una herramienta poderosa para detectar cambios filogen√©ticos cualitativos en las comunidades. Al combinar las visualizaciones interactivas (PCoA/Emperor) con las pruebas de significancia y los datos num√©ricos, obtenemos una evaluaci√≥n tanto exploratoria como estad√≠stica de si los grupos experimentales difieren en la presencia o ausencia de linajes microbianos.
</p>








<div style="height: 15px; background-color: transparent;"></div>

<div class="titulo3" id="tab3-seccion6.3.4">
  6.3.4. Weighted UniFrac (filogenia + abundancias)
</div>

<p>
  La m√©trica <strong>Weighted UniFrac</strong> combina informaci√≥n filogen√©tica con la <em>abundancia relativa</em> de los taxones, de modo que mide la disimilitud entre comunidades teniendo en cuenta tanto qu√© linajes est√°n presentes como en qu√© proporci√≥n. A diferencia del Unweighted UniFrac (que trata por igual taxones raros y abundantes), Weighted UniFrac penaliza m√°s las diferencias afectando a taxones abundantes y, al mismo tiempo, incorpora la distancia evolutiva entre ellos. Esto la convierte en una m√©trica especialmente adecuada para detectar cambios en la estructura comunitaria que implican variaciones en la abundancia de linajes filogen√©ticamente relevantes.
</p>

<p>
  Desde el punto de vista ecol√≥gico, <strong>valores bajos de Weighted UniFrac</strong> indican que dos comunidades comparten tanto linajes como sus proporciones relativas, mientras que <strong>valores altos</strong> muestran diferencias filogen√©ticas y/o en la abundancia de los linajes dominantes. Comparar Weighted UniFrac con otras m√©tricas (por ejemplo, Unweighted UniFrac y Bray‚ÄìCurtis) ayuda a distinguir si las diferencias entre grupos se deben principalmente a la presencia/ausencia de linajes, a cambios en abundancias relativas, o a una combinaci√≥n de ambos.
</p>

<p>
  En este an√°lisis disponemos de una visualizaci√≥n interactiva y de los artefactos num√©ricos subyacentes que permiten tanto la exploraci√≥n gr√°fica como el rean√°lisis cuantitativo.
</p>






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Visualizaci√≥n: <code>weighted_unifrac_emperor.qzv</code>
</div>

<p>
  El archivo <code>weighted_unifrac_emperor.qzv</code> contiene un PCoA interactivo (Emperor) donde cada punto representa una muestra y la distancia entre puntos refleja la disimilitud seg√∫n Weighted UniFrac. La vista interactiva permite colorear por variables de metadata, rotar el espacio 3D, seleccionar muestras y comprobar la influencia de factores experimentales sobre la estructura comunitaria combinada filogenia‚Äìabundancia. Esta visualizaci√≥n es √∫til para identificar agrupamientos impulsados por cambios en taxones abundantes dentro de linajes evolutivamente relevantes.
</p>

```{r, results='asis'}
# Incrustar index.html si est√° disponible
if (file.exists(indices_html$`weighted_unifrac_emperor`)) {

  cat(glue::glue('
  <iframe src="{indices_html$`weighted_unifrac_emperor`}" width="100%" height="700px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

  <p style="text-align:center;">
    <a href="{indices_html$`weighted_unifrac_emperor`}" target="_blank" class="boton-iframe">
      üìä Abrir Weighted UniFrac (Emperor) en nueva pesta√±a
    </a>
  </p>

  <div style="height: 15px; background-color: transparent;"></div>
  \n\n'))

} else {

  cat(glue::glue('
  <div class="alert-box">
    ‚ùå <span style="font-size:18px;">Visualizaci√≥n no disponible</span><br>
    <span style="font-size:14px; font-weight:normal;">
      No se encontr√≥ el <code>index.html</code> de <code>weighted_unifrac_emperor.qzv</code>. 
      Aseg√∫rese de haber descomprimido el archivo <code>.qzv</code> en la carpeta de <code>unzip</code>.
    </span>
  </div>
  \n\n'))
}
```






<div style="height: 13px; background-color: transparent;"></div>

<div class="titulo4">
  ‚û§ Archivos num√©ricos
</div>

<p>
  Adem√°s de la visualizaci√≥n, QIIME 2 genera los artefactos num√©ricos que permiten an√°lisis reproducibles y pruebas estad√≠sticas:
</p>

<ul style="list-style-type: none; padding-left: 20px;">
  <li>‚Üí <strong><code>weighted_unifrac_distance_matrix.qza</code></strong>: matriz de distancias Weighted UniFrac entre todas las muestras (cada celda representa la disimilitud filogen√©tica ponderada por abundancia entre un par de muestras).</li>
  <li>‚Üí <strong><code>weighted_unifrac_pcoa_results.qza</code></strong>: resultados PCoA con las coordenadas de cada muestra y la varianza explicada por cada eje; √∫til para extraer tablas de coordenadas y para gr√°ficas personalizadas en R.</li>
</ul>

<p>
  Estos archivos son la base para realizar an√°lisis estad√≠sticos complementarios fuera de QIIME 2, por ejemplo <strong>PERMANOVA</strong> (para evaluar si la variable de inter√©s explica una fracci√≥n significativa de la variaci√≥n entre muestras) o <strong>PERMDISP</strong> (para comprobar la homogeneidad de dispersiones entre grupos). Tambi√©n permiten reproducir las figuras en R (por ejemplo, con <code>qiime2R::read_qza()</code> y <code>ggplot2</code>), a√±adir anotaciones, calcular medidas de efecto o integrar covariables en modelos multivariables.
</p>

<p>
  Cuando se interpretan los resultados conviene tener en cuenta posibles artefactos: Weighted UniFrac puede verse influida por diferencias en depth de secuenciaci√≥n o por la presencia de taxones extremadamente abundantes; por ello es recomendable confirmar que la rarefacci√≥n/normalizaci√≥n y los controles de calidad previos se han aplicado correctamente (v√©ase la subsecci√≥n de rarefacci√≥n y <code>rarefied_table.qza</code>). Comparar la se√±al de Weighted UniFrac con la de Unweighted UniFrac y Bray‚ÄìCurtis facilita identificar si las diferencias observadas responden m√°s a cambios en abundancia, a cambios filogen√©ticos cualitativos, o a ambos.
</p>

<p>
  En resumen, Weighted UniFrac aporta una perspectiva integrada (filogen√©tica + cuantitativa) sobre la disimilitud entre comunidades y complementa las otras m√©tricas de diversidad beta. La combinaci√≥n de la visualizaci√≥n interactiva y de los artefactos num√©ricos permite abordar tanto la exploraci√≥n visual como la validaci√≥n estad√≠stica de los patrones observados en relaci√≥n con las variables experimentales.
</p>
