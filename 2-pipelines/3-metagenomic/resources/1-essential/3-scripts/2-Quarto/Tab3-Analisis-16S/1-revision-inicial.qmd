---
title: "RNA-Seq Report"

include-in-header:
  text: |
    <link rel="shortcut icon" href="../../../1-images/0-icono/favicon.svg"/>
    <link rel="icon" type="image/x-icon" href="../../../1-images/0-icono/favicon.ico">

params:
  ruta_proyecto: ""
  nombre_experimento: ""
---


<!-- &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& -->
<!--  TAB 3: ANLISIS | 1. REVISIN INICIAL DEL CONJUNTO DE MUESTRAS Y METADATOS -->
<!-- &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&& -->

<div class="informe-titulo-tab">
  <h1>Pesta帽a</h1>
  <h2>An谩lisis bioinform谩tico completo</h2>
</div>

<div class="informe-titulo-seccion">
  <h1>Secci贸n 1</h1>
  <h2>Revisi贸n inicial del conjunto de muestras y metadatos</h2>
</div>


<div class="informe-resumen">
  <h2>Resumen</h2>

  <p>
    En esta primera secci贸n se realiza una exploraci贸n preliminar de los datos disponibles con el objetivo de entender la estructura del experimento y garantizar la coherencia de las muestras antes de abordar los an谩lisis posteriores. Para ello, se incorpora un visor interactivo que permite navegar por la organizaci贸n de carpetas del proyecto, ofreciendo una visi贸n estructurada del entorno de trabajo y de los archivos generados en las etapas iniciales.
  </p>

  <p>
    Uno de los elementos clave analizados es el archivo de metadatos, el cual proporciona informaci贸n esencial sobre cada muestra. En concreto, se examinan tres variables principales:
  </p>

  <ul>
    <li><strong>Filename:</strong> indica el nombre del archivo original (.fastq.gz) que contiene las lecturas crudas.</li>
    <li><strong>Name:</strong> representa el identificador interno asignado a cada muestra, utilizado de forma coherente a lo largo del pipeline.</li>
    <li><strong>Type:</strong> define el grupo experimental al que pertenece la muestra (por ejemplo, caso, control, replicado, etc.).</li>
  </ul>

  <p>
    Esta revisi贸n no solo permite validar la correcta anotaci贸n de las muestras y su clasificaci贸n experimental, sino tambi茅n anticipar posibles problemas o inconsistencias. Finalmente, se ofrece una visualizaci贸n adicional que muestra todos los archivos <code>fastq.gz</code> disponibles, lo que permite confirmar la integridad del conjunto de datos iniciales desde los cuales se iniciar谩 el an谩lisis de calidad y procesamiento t茅cnico.
  </p>
</div>










<div style="height: 15px; background-color: transparent;"></div>

<div class="titulo-toc">
  Tabla de contenidos de esta secci贸n
</div>

<div class="toc">
  <ul>
    <li>
      <a href="#tab3-seccion1">1<span>.</span> Revisi贸n inicial del conjunto de muestras y metadatos</a>
      <ul>
        <li><a href="#tab3-seccion1.1">1.1. Organizaci贸n y estructura del proyecto</a></li>
        <li><a href="#tab3-seccion1.2">1.2. Revisi贸n del archivo de metadatos</a></li>
        <li><a href="#tab3-seccion1.3">1.3. Exploraci贸n inicial de las muestras de entrada</a></li>
      </ul>
    </li>
  </ul>
</div>











<!-- #%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
<!-- REDACCIN -->
<!-- #%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->

<div style="height: 25px; background-color: transparent;"></div>

<div class="titulo1" id="tab3-seccion1">
  1<span>.</span> Revisi贸n inicial del conjunto de muestras y metadatos
</div>

```{r}
library(glue)
library(fs)
library(stringr)
library(dplyr)

# Definir rutas clave
ruta_qmd <- getwd()

ruta_rnaseq_pipeline <- sub("(.*?/1-bulk-rna-seq).*", "\\1", ruta_qmd)

nombre_proyecto <- basename(params$ruta_proyecto)

ruta_nextflow_results <- file.path("..", "..", "..", "..", "..", "resources", "2-nextflow-results")
ruta_proyecto_relativa <- file.path("..", "..", "..", "..", "..", "resources", "2-nextflow-results", "1-project-data", nombre_proyecto)


targets_experimento <- paste0("targets_", params$nombre_experimento, ".txt")

ruta_targets_experimento <- file.path(params$ruta_proyecto, "Resultados", targets_experimento)
file_ruta_targets_experimento <- gsub(" ", "%20", paste0("file:///", ruta_targets_experimento))

ruta_targets_experimento_relativa <- file.path(ruta_proyecto_relativa, "Resultados", targets_experimento)


reads_down_select_experimento <- paste0("reads_down_select_", params$nombre_experimento)

ruta_reads_down_select_experimento <- file.path(params$ruta_proyecto, "Analisis", reads_down_select_experimento)

ruta_reads_down_select_experimento_relativa <- file.path(ruta_proyecto_relativa, "Analisis", reads_down_select_experimento)


ruta_Pre_fastqc_results <- file.path(params$ruta_proyecto, "Analisis", params$nombre_experimento, "Pre_fastqc_results")

ruta_Pre_fastqc_results_relativa <- file.path(ruta_proyecto_relativa, "Analisis", params$nombre_experimento, "Pre_fastqc_results")


# Leer targets
targets <- read.table(ruta_targets_experimento, header = TRUE, fill = TRUE, stringsAsFactors = FALSE)


# Listar archivos fastqc y fastq
archivos_fastqc <- list.files(ruta_Pre_fastqc_results, pattern = "_fastqc\\.html$", full.names = FALSE)
archivos_fastq <- list.files(ruta_reads_down_select_experimento, pattern = "\\.fastq\\.gz$", full.names = FALSE)


# Extraer identificadores base
ids_fastqc <- unique(gsub("(_R[12])?_fastqc\\.html$", "", archivos_fastqc))
ids_fastq <- unique(gsub("_R[12]\\.fastq\\.gz$", "", archivos_fastq))
ids_targets <- targets$Filename


# Identificar diferencias
fastqc_no_targets <- setdiff(ids_fastqc, ids_targets)
targets_no_fastqc <- setdiff(ids_targets, ids_fastqc)
targets_no_reads <- setdiff(ids_targets, ids_fastq)
```

<p>
  Antes de iniciar el an谩lisis t茅cnico y estad铆stico de los datos de expresi贸n g茅nica, es fundamental realizar una revisi贸n preliminar del entorno de trabajo, los archivos disponibles y la informaci贸n asociada a cada muestra. Esta secci贸n tiene como objetivo contextualizar el dise帽o experimental, validar la organizaci贸n de los datos y asegurar la integridad y consistencia de las muestras. Para ello, se examina tanto la estructura de carpetas del proyecto como el archivo de metadatos, y se identifican los archivos de lectura cruda que servir谩n como punto de partida para los an谩lisis posteriores.
</p>








<div style="height: 20px; background-color: transparent;"></div>

<div class="titulo2" id="tab3-seccion1.1">
  1.1. Organizaci贸n y estructura del proyecto
</div>

```{r, results="asis"}
cat(glue::glue('
<p>
  El an谩lisis de expresi贸n g茅nica que se presenta a continuaci贸n se basa en un conjunto de muestras seleccionadas del experimento <strong><em>{params$nombre_experimento}</em></strong>, definido dentro de la ruta general del proyecto:
</p>

<code>{params$ruta_proyecto}</code>

<p>
  Los archivos y carpetas que componen este entorno de trabajo pueden explorarse mediante el siguiente visor interactivo, el cual permite navegar por la jerarqu铆a del proyecto y consultar los contenidos de forma estructurada, proporcion谩ndose adem谩s un acceso directo a los recursos relevantes mediante botones espec铆ficos. Mencionar, eso s铆, que aqu铆 podremos visualizar solo los archivos m谩s relevantes y esenciales para la elaboraci贸n de este informe, mientras que archivos m谩s pesados (como podr铆an ser archivos <code>.fastq.gz</code>), han sido ignorados en el proceso de copiado de archivos a la ruta de este informe dado el alto volumen de espacio y tiempo requerido para ello. As铆, en el caso de querer explorar estos archivos espec铆ficos ser谩 necesario consultar la carpeta original con los resultados proporcionados por la herramienta <strong>miARma-Seq</strong>.
</p>
\n\n'))
```

<div class="box-files">

```{r, echo=FALSE, results="asis"}
if (!dir.exists(ruta_proyecto_relativa)) {
  cat(sprintf('<p><em>La ruta "%s" no existe o no es accesible.</em></p>\n', ruta_proyecto_relativa))
} else {
  # Listar todos los archivos, sin filtros
  files <- list.files(ruta_proyecto_relativa, full.names = FALSE)
  
  if (length(files) == 0) {
    cat('<p><em>No se encontraron archivos en la carpeta especificada.</em></p>\n')
  } else {
    enlace <- ruta_proyecto_relativa
    
    cat("<ul>\n")
    for (f in files) {
      # Asignar clase seg煤n la extensi贸n
      clase <- if (!grepl("\\.", f)) {
        "file-folder"
      } else if (grepl("\\.html$", f)) {
        "file-html"
      } else if (grepl("\\.zip$", f)) {
        "file-zip"
      } else if (grepl("\\.fastq\\.gz$", f)) {
        "file-fastqgz"
      } else {
        "file-default"
      }
      
      cat(sprintf('<li class="%s"><a href="%s/%s" target="_blank">%s</a></li>\n',
                  clase, enlace, f, f))
    }
    cat("</ul>\n")
  }
}
```

</div>

```{r, results="asis"}
# Para que funcione con rutas absolutas
enlace <- ruta_proyecto_relativa

# Imprimir el enlace
cat(glue::glue('
<p style="text-align:center;">
  <a href="{enlace}" target="_blank" class="boton-files">
     Explora los archivos de la carpeta "{nombre_proyecto}" aqu铆
  </a>
</p>
\n\n'))
```

```{r, results="asis"}
cat(glue::glue('
<p>
  A continuaci贸n, m谩s en detalle se presenta la estructura de carpetas y archivos empleada en el experimento <code>{params$nombre_experimento}</code>, perteneciente al proyecto <code>{nombre_proyecto}</code>. Esta organizaci贸n ha sido dise帽ada para facilitar tanto el desarrollo reproducible del an谩lisis como la posterior consulta e interpretaci贸n de los resultados.
</p>

<ul>
  <li>
    <code>{nombre_proyecto}/Analisis/</code>
    <ul>
      <li>
        <code>{params$nombre_experimento}/</code>: Directorio principal del an谩lisis computacional, que contiene las salidas intermedias generadas durante el preprocesamiento y cuantificaci贸n de la expresi贸n g茅nica:
        <ul>
          <li><code>Pre_fastqc_results/</code>: Archivos individuales de control de calidad de las lecturas crudas, obtenidos con <em>FastQC</em>. Permiten verificar la calidad general de las secuencias antes del alineamiento.</li>
          <li><code>hisat2_results/</code>: Archivos de alineamiento en formato SAM/BAM generados mediante <em>HISAT2</em>, que permiten mapear las secuencias a un genoma de referencia.</li>
          <li><code>Readcount_results/</code>: Archivos de cuantificaci贸n bruta de expresi贸n g茅nica, donde se almacena una matriz de conteos por gen y por muestra antes de la normalizaci贸n.</li>
        </ul>
      </li>
      <li>
        <code>reads_down_select_{params$nombre_experimento}/</code>: Directorio donde se encuentral almacenados los archivos de lectura seleccionados para el estudio.
      </li>
    </ul>
  </li>

  <li>
    <code>{nombre_proyecto}/Resultados/</code>: Carpeta que agrupa todos los resultados derivados del an谩lisis, organizados para facilitar su exploraci贸n y revisi贸n:
    <ul>
      <li><code>targets_{params$nombre_experimento}.txt</code>: Archivo de metadatos con informaci贸n sobre las muestras (nombre, condici贸n, replicados, etc.), fundamental para el dise帽o experimental y el an谩lisis estad铆stico posterior.</li>
      <li>
        <code>{params$nombre_experimento}/</code>: Subcarpeta con productos generados a partir de la matriz de expresi贸n normalizada y los an谩lisis estad铆sticos derivados:
        <ul>
          <li>
            <code>{params$nombre_experimento}_QC.pdf</code>: Informe gr谩fico posterior a la normalizaci贸n. Incluye visualizaciones clave como PCA, clustering jer谩rquico, correlaciones entre muestras, boxplots y distribuciones de expresi贸n. Estas gr谩ficas permiten evaluar si el preprocesamiento ha corregido adecuadamente la variabilidad t茅cnica sin distorsionar las se帽ales biol贸gicas relevantes.
          </li>
          <li>
            <code>{params$nombre_experimento}_RPKM.xls</code>: Matriz de expresi贸n g茅nica transformada a valores normalizados en unidades RPKM, adecuada para visualizaci贸n y exploraci贸n comparativa entre muestras.
          </li>
          <li>
            Archivos <code>.xlsx</code>: Resultados del an谩lisis de expresi贸n diferencial para cada comparaci贸n experimental. Incluyen medidas estad铆sticas (logFC, p-valor, FDR) para cada gen evaluado.
          </li>
          <li>
            Archivos <code>*.Volcano*.pdf</code>: Gr谩ficos <em>volcano</em> que resumen visualmente los genes diferencialmente expresados m谩s relevantes, combinando magnitud del cambio y significaci贸n estad铆stica.
          </li>
          <li>
            <code>Enrichment/</code>: Carpeta que contiene los resultados del an谩lisis funcional y de enriquecimiento basado en los genes diferencialmente expresados (DEG). Para cada comparaci贸n entre condiciones experimentales se incluyen:
            <ul>
              <li>
                Un archivo <code>.pdf</code> con representaciones visuales (por ejemplo, <em>barplots</em> o <em>dotplots</em>) que destacan los t茅rminos funcionales m谩s significativamente enriquecidos.
              </li>
              <li>
                Un archivo <code>.xls</code> con un listado exhaustivo de categor铆as enriquecidas (GO:BP, GO:MF, GO:CC y rutas KEGG), incluyendo valores de p, FDR y n煤mero de genes asociados a cada t茅rmino.
              </li>
            </ul>
            Este an谩lisis permite contextualizar biol贸gicamente los resultados identificando procesos, funciones o rutas alteradas en las condiciones evaluadas.
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>
  Esta estructura modular y coherente no solo permite automatizar los pasos clave del an谩lisis bioinform谩tico, sino que tambi茅n garantiza trazabilidad, reproducibilidad y facilidad de interpretaci贸n. Adem谩s, contribuye a una mejor documentaci贸n del flujo de trabajo, lo cual es especialmente 煤til en entornos colaborativos o proyectos de largo recorrido.
</p>
\n\n'))
```








<div style="height: 20px; background-color: transparent;"></div>

<div class="titulo2" id="tab3-seccion1.2">
  1.2. Revisi贸n del archivo de metadatos
</div>

<p>
  Como ya se ha comentado anteriormente, la definici贸n del conjunto de muestras analizadas en este estudio se encuentra detallada en un archivo de metadatos, accesible en la siguiente ubicaci贸n (bas谩ndonos donde sen encontraba el archivo en el momento de la generaci贸n del informe):
</p>

```{r, results="asis"}
cat(glue::glue('
<code>{ruta_targets_experimento}</code>
\n\n'))
```

<p>
  Este archivo desempe帽a un papel clave en la organizaci贸n del an谩lisis, ya que proporciona la informaci贸n necesaria para identificar, clasificar y vincular cada muestra con su contexto experimental. Contiene columnas fundamentales como:
</p>

<ul>
  <li><strong>Filename</strong>: nombre del archivo que contiene los datos crudos (por ejemplo, archivos <code>.fastq.gz</code>).</li>
  <li><strong>Name</strong>: identificador interno 煤nico de la muestra, utilizado de manera coherente a lo largo del pipeline.</li>
  <li><strong>Type</strong>: grupo o condici贸n experimental a la que pertenece la muestra (por ejemplo, <code>pex11a-C</code> o <code>px-ck-C</code>).</li>
</ul>

<p>
  A continuaci贸n, se muestra una tabla interactiva que resume esta informaci贸n, permitiendo una revisi贸n visual y filtrada de las muestras incluidas en el experimento. Esto facilita comprobar su denominaci贸n interna y su asignaci贸n a los grupos experimentales:
</p>

```{r, results="asis"}
# Tabla interactiva de metadatos
library(DT)

htmltools::div(
  class = "scroll-y-max-500",
  DT::datatable(
    targets,
    options = list(
      scrollX = TRUE,
      paging = FALSE,
      lengthChange = FALSE,
      language = list(
        url = '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
      )
    ),
    class = 'stripe hover compact',
    rownames = FALSE
  )
)
```

<div style="height: 20px; background-color: transparent;"></div>

<p>
  Para consultar el archivo completo, puede utilizar el visor incrustado que se presenta a continuaci贸n o, si lo prefiere, abrir el documento en una pesta帽a independiente para una exploraci贸n m谩s c贸moda:
</p>

```{r, results='asis'}
cat(glue::glue('
<iframe src="{ruta_targets_experimento_relativa}" width="100%" height="500px" style="border: 1px solid #ccc; border-radius: 6px;"></iframe>

<p style="text-align:center;">
  <a href="{ruta_targets_experimento_relativa}" target="_blank" class="boton-iframe">
     Ver metadatos completos en una nueva p谩gina
  </a>
</p>

<div style="height: 15px; background-color: transparent;"></div>
\n\n'))
```

<p>
  El archivo de metadatos es una pieza esencial para asegurar la trazabilidad del an谩lisis, ya que documenta de forma estructurada la correspondencia entre las muestras, sus nombres internos y los grupos experimentales. Esta trazabilidad garantiza tanto la reproducibilidad como una interpretaci贸n correcta de los resultados obtenidos.
</p>








<div style="height: 20px; background-color: transparent;"></div>

<div class="titulo2" id="tab3-seccion1.3">
  1.3. Exploraci贸n inicial de las muestras de entrada
</div>


<p>
  Este apartado tiene como objetivo ofrecer una primera visi贸n estructurada de los archivos de lectura que constituyen la base del an谩lisis transcript贸mico. Estos archivos, en formato <code>.fastq.gz</code>, representan las secuencias crudas obtenidas tras la secuenciaci贸n de ARN y han sido previamente sometidos a un proceso de depuraci贸n y organizaci贸n.
</p>

<p>
  Las muestras utilizadas han sido definidas en el archivo de metadatos, y sus identificadores han sido cuidadosamente vinculados a los correspondientes archivos de lectura. Esta asociaci贸n garantiza la trazabilidad completa desde los datos brutos hasta los resultados del an谩lisis, minimizando posibles inconsistencias o errores en las fases posteriores del pipeline.
</p>

<p>
  A continuaci贸n, se indica el directorio donde se encontraban almacenados los archivos de lectura seleccionados para el estudio en el momento de generaci贸n del informe:
</p>

```{r, results='asis'}
cat(glue::glue('
<code>{ruta_reads_down_select_experimento}</code>
\n\n'))
```

<p>
  Este directorio alberga una copia limpia y estructurada de los archivos de lectura para cada muestra incluida en el an谩lisis. Cada archivo <code>.fastq.gz</code> est谩 nombrado de forma coherente con su correspondiente entrada en la tabla de metadatos, facilitando la automatizaci贸n y reproducibilidad del flujo de trabajo.
</p>

<p>
  En la siguiente tabla interactiva se muestra el listado completo de archivos que ser谩n empleados en los pasos de alineamiento y cuantificaci贸n. Esta vista permite verificar de manera r谩pida la integridad del conjunto de muestras y revisar su correspondencia con la informaci贸n previamente definida:
</p>

<div class="box-files">

```{r, results="asis"}
if (!dir.exists(ruta_reads_down_select_experimento)) {
  cat(sprintf('<p><em>La ruta "%s" no existe o no es accesible.</em></p>\n', ruta_reads_down_select_experimento))
} else {
  # Listar solo archivos con extensi贸n .ht2
  files <- list.files(ruta_reads_down_select_experimento, pattern = "\\.fastq.gz$", full.names = FALSE)
  
  if (length(files) == 0) {
    cat('<p><em>No se encontraron archivos con extensi贸n <code>.fastq.gz</code> en la carpeta especificada.</em></p>\n')
  } else {
    enlace <- paste0("file://", ruta_reads_down_select_experimento)
    
    cat("<ul>\n")
    for (f in files) {
      # Asignar clase seg煤n la extensi贸n
      clase <- if (!grepl("\\.", f)) {
        "file-folder"
      } else if (grepl("\\.html$", f)) {
        "file-html"
      } else if (grepl("\\.zip$", f)) {
        "file-zip"
      } else if (grepl("\\.fastq\\.gz$", f)) {
        "file-fastqgz"
      } else {
        "file-default"
      }
      
      cat(sprintf('<li class="%s"><a href="%s/%s" target="_blank">%s</a></li>\n',
                  clase, enlace, f, f))
    }
    cat("</ul>\n")
  }
}
```

</div>

<div style="height: 15px; background-color: transparent;"></div>

<p>
  Tras esta exploraci贸n preliminar de las muestras, el informe contin煤a con una secci贸n dedicada al control de calidad de los datos crudos. En ella se presenta un resumen global generado mediante <code>MultiQC</code>, que consolida las m茅tricas de calidad de todas las muestras analizadas.
</p>

<p>
  Adem谩s del resumen agregado, tambi茅n se incluyen los informes individuales generados por <code>FastQC</code>. Estos informes detallan aspectos espec铆ficos de cada muestra, como la calidad base a base, la longitud de las secuencias, la proporci贸n de contenido GC, la presencia de secuencias repetidas o adaptadores, entre otras m茅tricas clave para asegurar la fiabilidad del an谩lisis transcript贸mico.
</p>
